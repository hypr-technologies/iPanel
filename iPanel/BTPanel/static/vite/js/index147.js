import{_ as e}from"./index184.js?v=1752142539265";import{_ as a,d as n,c as t,b as s,f as l,h as i,q as o}from"./public.js?v=1752142539265";import{_ as u,a as _}from"./index.vue_vue_type_script_setup_true_lang20.js?v=1752142539265";import{k as r,U as c,X as d,Q as f,a2 as p,V as b,a3 as m,F as y,P as x,W as h,j as g,a1 as z,r as v,ah as k,e as w,O as q}from"./vue.js?v=1752142539265";import{_ as P}from"./index.vue_vue_type_script_setup_true_lang9.js?v=1752142539265";import{d_ as M,d$ as j,p as B,e0 as N,aZ as S,e1 as C,d as I,W as $,V as T,O as U,X as F,n as L,e2 as G,e3 as R,e4 as K,e5 as O,e6 as Q,w as D,e7 as A,e8 as X}from"./page_layout.js?v=1752142539265";import{g as E,m as H,p as V}from"./soft.js?v=1752142539265";import{ay as W,bX as Z,bZ as J,c3 as Y,c1 as ee,cD as ae}from"./naive.js?v=1752142539265";import{s as ne}from"./php.js?v=1752142539265";import{_ as te}from"./index96.js?v=1752142539265";import{_ as se}from"./index101.js?v=1752142539265";import{o as le}from"./logs.js?v=1752142539265";import{c as ie}from"./file.js?v=1752142539265";import"./common.js?v=1752142539265";import"./__commonjsHelpers__.js?v=1752142539265";import"./alarm.js?v=1752142539265";import"./index.vue_vue_type_script_setup_true_lang.js?v=1752142539265";import"./index.vue_vue_type_script_setup_true_lang10.js?v=1752142539265";import"./index.vue_vue_type_script_setup_true_lang14.js?v=1752142539265";import"./theme-chrome.js?v=1752142539265";const oe=r({__name:"index",setup:e=>(e,n)=>{const t=a;return d(),c(y,null,[f(u),f(t,{class:"mt-10px"},{default:p((()=>[b("li",null,m(e.$t("Plugin.Mysql.index_25")),1)])),_:1})],64)}}),ue=r({__name:"index",setup(e,{expose:t}){const{t:s}=x(),l=()=>{n({title:s("Plugin.Mysql.index_16"),content:s("Plugin.Mysql.index_17",[H.datadir]),onConfirm:async()=>{await M({datadir:H.datadir})}})};return E(),t({init:E}),(e,n)=>{const t=P,s=W,i=Z,o=a;return d(),c(y,null,[f(i,null,{default:p((()=>[f(t,{value:h(H).datadir,"onUpdate:value":n[0]||(n[0]=e=>h(H).datadir=e),class:"w-300px"},null,8,["value"]),f(s,{type:"primary",onClick:l},{default:p((()=>[g(m(e.$t("Plugin.Mysql.index_13")),1)])),_:1})])),_:1}),f(o,{class:"mt-10px"},{default:p((()=>[b("li",null,m(e.$t("Plugin.Mysql.index_14")),1),b("li",null,m(e.$t("Plugin.Mysql.index_15")),1)])),_:1})],64)}}}),_e=r({__name:"index",setup(e,{expose:a}){const n=async()=>{await j({port:H.port})};return E(),a({init:E}),(e,a)=>{const t=J,s=W,l=Z;return d(),z(l,null,{default:p((()=>[f(t,{class:"w-100px!","show-button":!1,value:h(H).port,"onUpdate:value":a[0]||(a[0]=e=>h(H).port=e),placeholder:e.$t("Site.TableRow.index_16")},null,8,["value","placeholder"]),f(s,{type:"primary",onClick:n},{default:p((()=>[g(m(e.$t("Public.Btn.Conf")),1)])),_:1})])),_:1})}}}),re=r({__name:"index",setup(e,{expose:s}){const{t:l}=x(),i=v(!1),o=async()=>{try{await N()}catch(e){i.value=!i.value}},u=()=>{n({title:l("Plugin.Mysql.index_22",[V.title]),content:l("Plugin.Mysql.index_24",[V.title]),onConfirm:async()=>{await ne({name:"mysqld",type:"restart"})}})},_=()=>{S(encodeURIComponent("/www/server/data/ssl.zip"))},{loading:r,setLoading:z}=t(),w=async()=>{try{z(!0);const{message:e}=await C();I(e)&&(i.value=e.status)}finally{z(!1)}};return w(),s({init:w}),(e,n)=>{const t=Y,s=ee,l=W,x=Z,z=B,v=a;return d(),c(y,null,[f(t,{class:"mb-16px",type:"info"},{default:p((()=>n[1]||(n[1]=[g(" This feature will be discontinued in the next version ")]))),_:1,__:[1]}),f(x,{class:"items-center"},{default:p((()=>[b("span",null,m(e.$t("Plugin.Mysql.index_30"))+" Mysql SSL",1),f(s,{value:h(i),"onUpdate:value":[n[0]||(n[0]=e=>k(i)?i.value=e:null),o],loading:h(r)},null,8,["value","loading"]),f(l,{onClick:u,type:"primary"},{default:p((()=>[g(m(e.$t("Plugin.Mysql.index_22",[h(V).title])),1)])),_:1})])),_:1}),f(z,{class:"my-16px!"}),f(v,{class:"mb-16px"},{default:p((()=>[b("li",null,m(e.$t("Database.Mysql.index_27")),1),b("li",null,[g(m(e.$t("Database.Mysql.index_28"))+" ",1),b("a",{class:"bt-link",onClick:_},"【SSL.zip】")])])),_:1})],64)}}}),ce=[{label:"Launch Time",value:"Run",isTime:!0},{label:"Total Connections",value:"Connections"},{label:"Send",value:"Bytes_sent",isSize:!0},{label:"Receive",value:"Bytes_received",isSize:!0},{label:"Query per second",value:"query"},{label:"Transaction per second",value:"transaction"},{label:"File",value:"File"},{label:"Position",value:"Position"}],de=[{name:"Active/Max connections",function:e=>e.Threads_running+"/"+e.Max_used_connections,value:"",ps:"If too high, increase max_connections"},{name:"Thread cache hit rate",value:"",function:e=>{const a=(100*(1-Number(e.Threads_created)/Number(e.Connections))).toFixed(2);return a?a+"%":"0"},ps:"If too low, increase thread_cache_size"},{value:"",name:"Index hit rate",function:e=>{const a=Number(e.Key_reads),n=Number(e.Key_read_requests);return(n>0?(100*(1-a/n)).toFixed(2):"0.00")+"%"},ps:"If too low, increase key_buffer_size"},{value:"",name:"Innodb index hit rate",function:e=>{const a=(100*(1-Number(e.Innodb_buffer_pool_reads)/Number(e.Innodb_buffer_pool_read_requests))).toFixed(2);return a||"0"},ps:"If too low, increase innodb_buffer_pool_size"},{value:"",name:"Query cache hit rate",function:e=>{let a=(parseInt(e.Qcache_hits)/(parseInt(e.Qcache_hits)+parseInt(e.Qcache_inserts))*100).toFixed(2)+"%";return"NaN%"==a&&(a="OFF"),a},ps:"If too low, increase query_cache_size"},{value:"",name:"Created temporary tables to disk",function:e=>{const a=(Number(e.Created_tmp_disk_tables)/Number(e.Created_tmp_tables)*100).toFixed(2);return a?a+"%":"0"},ps:"If too high, increase tmp_table_size"},{value:"",name:"Opened table",function:e=>e.Open_tables,ps:"If too high, increase table_open_cache"},{value:"",name:"Amount unindexed",function:e=>e.Select_full_join,ps:"If not 0, please check index of database table"},{value:"",name:"Amount unindexed in table join",function:e=>e.Select_range_check,ps:"If not 0, please check index of database table"},{value:"",name:"Number of merges after sorting",function:e=>e.Sort_merge_passes,ps:"If too high, increase sort_buffer_size"},{value:"",name:"Number of lock tables",function:e=>e.Table_locks_waited,ps:"If too high, consider increase your database performance"}],fe=r({__name:"index",setup(e,{expose:a}){const{t:n}=x(),i=w({}),{table:o,columns:u}=s([{title:n("Plugin.Apache.index_12"),key:"name",width:"30%"},{title:n("Plugin.Apache.index_13"),key:"value",width:"20%"},{title:n("Public.Table.Note"),key:"ps",ellipsis:{tooltip:!0}}]),_=e=>{if("query"===e.value)return parseInt((Number(i.Questions)/Number(i.Uptime)).toString());if("transaction"===e.value)return parseInt(((parseInt(i.Com_commit)+parseInt(i.Com_rollback))/Number(i.Uptime)).toString());const a=i[e.value];return void 0===a?"--":e.isTime?F(a):e.isSize?L(a):a},{loading:r,setLoading:b}=t(),v=async()=>{try{b(!0);const{message:e}=await G();I(e)&&(Object.assign(i,e),de.forEach((e=>{e.function&&(e.value=e.function(i))})),o.data=de)}finally{b(!1)}};return v(),a({init:v}),(e,a)=>{const n=T,t=$,s=U,i=l;return d(),c(y,null,[f(s,{show:h(r)},{default:p((()=>[f(t,{"label-placement":"left",bordered:"",column:2},{default:p((()=>[(d(!0),c(y,null,q(h(ce),(e=>(d(),z(n,{label:e.label,key:e.value},{default:p((()=>[g(m(_(e)),1)])),_:2},1032,["label"])))),128))])),_:1})])),_:1},8,["show"]),f(i,{class:"mt-10px",loading:h(r),data:h(o).data,columns:h(u)},null,8,["loading","data","columns"])],64)}}}),pe=[{label:"1-2GB",value:"1-2GB",data:{key_buffer_size:32,query_cache_size:32,tmp_table_size:32,innodb_buffer_pool_size:64,sort_buffer_size:256,read_buffer_size:256,read_rnd_buffer_size:256,join_buffer_size:512,thread_stack:256,binlog_cache_size:64,thread_cache_size:64,table_open_cache:128,max_connections:100}},{label:"2-4GB",value:"2-4GB",data:{key_buffer_size:64,query_cache_size:64,tmp_table_size:64,innodb_buffer_pool_size:128,sort_buffer_size:512,read_buffer_size:512,read_rnd_buffer_size:512,join_buffer_size:1024,thread_stack:256,binlog_cache_size:64,thread_cache_size:96,table_open_cache:192,max_connections:200}},{label:"4-8GB",value:"4-8GB",data:{key_buffer_size:128,query_cache_size:128,tmp_table_size:128,innodb_buffer_pool_size:256,sort_buffer_size:1024,read_buffer_size:1024,read_rnd_buffer_size:768,join_buffer_size:2048,thread_stack:256,binlog_cache_size:128,thread_cache_size:128,table_open_cache:384,max_connections:300}},{label:"8-16GB",value:"8-16GB",data:{key_buffer_size:256,query_cache_size:256,tmp_table_size:256,innodb_buffer_pool_size:512,sort_buffer_size:1024,read_buffer_size:2048,read_rnd_buffer_size:1024,join_buffer_size:2048,thread_stack:384,binlog_cache_size:192,thread_cache_size:192,table_open_cache:1024,max_connections:400}},{label:"16-32GB",value:"16-32GB",data:{key_buffer_size:1024,query_cache_size:384,tmp_table_size:1024,innodb_buffer_pool_size:1024,sort_buffer_size:4096,read_buffer_size:4096,read_rnd_buffer_size:2048,join_buffer_size:4096,thread_stack:512,binlog_cache_size:256,thread_cache_size:256,table_open_cache:2048,max_connections:500}}],be={key_buffer_size:"MB, Buffer size for indexing",query_cache_size:"MB, Query cache, set to 0 for not enabled",tmp_table_size:"MB, Temporary table cache size",innodb_buffer_pool_size:"MB, Innodb buffer size",innodb_log_buffer_size:"MB, Innodb log buffer size",sort_buffer_size:"KB * Num of connections, Buffer size per thread sort",read_buffer_size:"KB * Num of connections, Read buffer size",read_rnd_buffer_size:"KB * Num of connections, Random read buffer size",join_buffer_size:"KB * Num of connections, Join table buffer size",thread_stack:"KB * Num of connections, Stack size per thread",binlog_cache_size:"KB * Num of connections, Bin log cache size (multiples of 4096)",thread_cache_size:"Thread cache size",table_open_cache:"Table open cache (NOT exceed 2048 at most)",max_connections:"Max connections"},me={class:"w-150px!"},ye={class:"w-250px! color-#666"},xe={class:"color-#666"},he=r({__name:"index",setup(e,{expose:a}){const{t:s}=x(),l=v(),i=v(),o=w({}),u=(e,a)=>{for(const n in a.data)o[n]=a.data[n];_()},_=()=>{const e=new Set(["key_buffer_size","query_cache_size","tmp_table_size","innodb_buffer_pool_size","innodb_log_buffer_size"]),a=new Set(["sort_buffer_size","read_buffer_size","read_rnd_buffer_size","join_buffer_size","thread_stack","binlog_cache_size"]),n=Number(o.max_connections||0),{a:t,b:s}=Object.entries(o).reduce(((n,[t,s])=>{const l=Number(s);return e.has(t)?n.a+=l:a.has(t)&&(n.b+=l/1024),n}),{a:0,b:0});i.value=(t+s*n).toString()},r=async()=>{const e={...o,query_cache_type:o.query_cache_size>0?1:0,max_heap_table_size:o.tmp_table_size};await R(e),_()},P=()=>{n({title:s("Plugin.Mysql.index_22",[V.title]),content:s("Plugin.Mysql.index_24",[V.title]),onConfirm:async()=>{await ne({name:"mysqld",type:"restart"})}})},{loading:M,setLoading:j}=t(),N=async()=>{try{j(!0),l.value=null;const{message:e}=await K();if(I(e)){const a=e.mem;null!=a.join_buffer_size||(a.join_buffer_size=512),null!=a.thread_stack||(a.thread_stack=256),null!=a.binlog_cache_size||(a.binlog_cache_size=32);for(const e in be)e in a&&(o[e]=a[e]);_()}}finally{j(!1)}};return N(),a({init:N}),(e,a)=>{const n=ae,t=Z,s=te,_=B,x=J,v=W,w=U;return d(),c(y,null,[f(t,{class:"justify-center!"},{default:p((()=>[f(t,{class:"items-center"},{default:p((()=>[b("span",null,m(e.$t("Plugin.Mysql.index_20")),1),f(n,{class:"w-150px",value:h(l),"onUpdate:value":[a[0]||(a[0]=e=>k(l)?l.value=e:null),u],options:h(pe),placeholder:e.$t("Ftp.Placeholder.Index_2")},null,8,["value","options","placeholder"])])),_:1}),f(t,{class:"items-center"},{default:p((()=>[g(m(e.$t("Plugin.Mysql.index_21")),1),f(s,{text:"MB",class:"w-150px!",value:h(i),"onUpdate:value":a[1]||(a[1]=e=>k(i)?i.value=e:null),readonly:""},null,8,["value"])])),_:1})])),_:1}),f(_,{class:"my-10px!"}),f(w,{show:h(M)},{default:p((()=>[(d(!0),c(y,null,q(h(o),((e,a)=>(d(),z(t,{class:"items-center flex-nowrap! py-2px",key:a},{default:p((()=>[b("div",me,m(a),1),f(x,{class:"w-150px!",value:h(o)[a],"onUpdate:value":e=>h(o)[a]=e,min:0,"show-button":!1},null,8,["value","onUpdate:value"]),b("div",ye,m(h(be)[a]),1)])),_:2},1024)))),128)),f(t,{class:"items-center justify-center! mt-10px"},{default:p((()=>[f(v,{type:"primary",onClick:r},{default:p((()=>[g(m(e.$t("Public.Btn.Save")),1)])),_:1}),f(v,{onClick:P},{default:p((()=>[g(m(e.$t("Plugin.Mysql.index_22",[h(V).title])),1)])),_:1}),b("span",xe,"*"+m(e.$t("Plugin.Mysql.index_23")),1)])),_:1})])),_:1},8,["show"])],64)}}}),ge=r({__name:"index",setup(e,{expose:a}){const n=v("None"),{loading:s,setLoading:l}=t(),i=async()=>{await le({close:1}),o()},o=async()=>{try{l(!0);const{message:e}=await le();I(e)&&(n.value=e.result?e.result:"None")}finally{l(!1)}};return o(),a({init:o}),(e,a)=>{const t=W,l=se,o=U;return d(),c(y,null,[f(t,{class:"mb-10px",onClick:i},{default:p((()=>[g(m(e.$t("Crontab.Planned.index_25")),1)])),_:1}),f(o,{class:"h-580px",show:h(s)},{default:p((()=>[f(l,{log:h(n)},null,8,["log"])])),_:1},8,["show"])],64)}}}),ze=r({__name:"index",setup(e,{expose:a}){const n=v("None"),{loading:s,setLoading:l}=t(),i=async()=>{try{l(!0);const{message:e}=await O();I(e)&&(n.value=e.result?e.result:"None")}finally{l(!1)}};return i(),a({init:i}),(e,a)=>{const t=se,l=U;return d(),z(l,{class:"h-610px",show:h(s)},{default:p((()=>[f(t,{log:h(n)},null,8,["log"])])),_:1},8,["show"])}}}),ve={class:"ml-20px"},ke=r({__name:"index",setup(e,{expose:u}){const{t:_}=x(),r=w({binlog_status:!1,size:0}),{table:g,columns:z}=s([{key:"name",title:_("Site.TableRow.index_22")},{key:"title",title:_("Site.TableRow.index_23"),render:e=>L(e.size)},{key:"title",title:_("Plugin.Mysql.index_8"),render:e=>F(e.last_modified)},i({width:70,options:e=>[{label:_("Public.Btn.Del"),onClick:()=>{o({title:_("Plugin.Mysql.index_9"),content:_("Plugin.Mysql.index_10",[e.name]),onConfirm:async()=>{await ie({path:e.path}),M()}})}}]})]),v=e=>{const a=_(e?"Public.Confirm.Enable":"Public.Status.Disable"),t=_(e?"Plugin.Mysql.index_11":"Plugin.Mysql.index_12");n({title:"".concat(a," ").concat(_("Plugin.Mysql.index_6")),content:t,onConfirm:async()=>{await A(),P()}})},{loading:k,setLoading:q}=t(),P=async()=>{const{message:e}=await A({status:1});I(e)&&(r.binlog_status=e.binlog_status,r.size=e.size)},M=async()=>{try{q(!0);const{message:e}=await Q();D(e)&&(g.data=e)}finally{q(!1)}},j=()=>{P(),M()};return j(),u({init:j}),(e,n)=>{const t=ee,s=Z,i=B,o=a,u=l;return d(),c(y,null,[f(s,{class:"items-center"},{default:p((()=>[b("span",null,m(e.$t("Plugin.Mysql.index_6")),1),f(t,{value:h(r).binlog_status,loading:h(k),"onUpdate:value":v},null,8,["value","loading"]),b("span",ve,m(h(L)(h(r).size)),1)])),_:1}),f(i,{class:"my-16px!"}),f(o,{class:"mb-16px"},{default:p((()=>[b("li",null,m(e.$t("Plugin.Mysql.index_7")),1)])),_:1}),f(u,{loading:h(k),data:h(g).data,columns:h(z),"max-height":400},null,8,["loading","data","columns"])],64)}}}),we=r({__name:"index",setup(e,{expose:n}){const s=v(!1),l=async e=>{await X({status:e?1:0}),u()},{loading:i,setLoading:o}=t(),u=async()=>{try{o(!0),await X(),s.value=!0}catch(e){s.value=!1}finally{o(!1)}};return u(),n({init:u}),(e,n)=>{const t=ee,o=Z,u=B,_=a;return d(),c(y,null,[f(o,{class:"items-center"},{default:p((()=>[b("span",null,m(e.$t("Plugin.Mysql.index_18")),1),f(t,{value:h(s),"onUpdate:value":[n[0]||(n[0]=e=>k(s)?s.value=e:null),l],loading:h(i)},null,8,["value","loading"])])),_:1}),f(u,{class:"my-16px!"}),f(_,{class:"mb-16px"},{default:p((()=>[b("li",null,m(e.$t("Plugin.Mysql.index_19")),1)])),_:1})],64)}}}),qe=r({__name:"index",setup(a){const{t:n}=x(),t=v("service"),s=[{key:"service",label:n("Security.History.Index_10"),component:oe},{key:"file",label:n("Site.Config.index_15"),data:{path:"/etc/my.cnf"},component:_},{key:"location",label:n("Plugin.Mysql.index_26"),component:ue},{key:"port",label:n("Site.TableRow.index_16"),component:_e},{key:"ssl",label:"SSL",component:re},{key:"status",label:n("Docker.Setting.index_2"),component:fe},{key:"optimization",label:n("Plugin.Mysql.index_27"),component:he},{key:"logs",label:n("Site.Config.index_101"),component:ge},{key:"slow",label:n("Plugin.Mysql.index_28"),component:ze},{key:"binary",label:n("Plugin.Mysql.index_6"),component:ke},{key:"memory",label:n("Plugin.Mysql.index_18"),component:we}];return(a,n)=>{const l=e;return d(),z(l,{value:h(t),"onUpdate:value":n[0]||(n[0]=e=>k(t)?t.value=e:null),data:s},null,8,["value"])}}});export{qe as default};


