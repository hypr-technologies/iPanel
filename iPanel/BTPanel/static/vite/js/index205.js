import{c as a,_ as e,ae as l,af as t,u as s,ag as n,ah as i,ai as d,ay as o}from"./public.js?v=1752142539265";import{_ as u}from"./index.vue_vue_type_script_setup_true_lang.js?v=1752142539265";import{a0 as r}from"./site.js?v=1752142539265";import{aF as p,O as _,d as m,w as c}from"./page_layout.js?v=1752142539265";import{cz as h,cB as f,cC as v,_ as y,cD as S,aq as x,cO as g,bX as w,bR as b}from"./naive.js?v=1752142539265";import{k as L,P as k,r as A,e as z,c as $,w as Z,o as j,U,X as O,Q as R,a2 as E,an as F,W as q,j as C,a3 as B,a1 as H,F as J,O as M,V as N}from"./vue.js?v=1752142539265";import"./common.js?v=1752142539265";import"./__commonjsHelpers__.js?v=1752142539265";const P={class:"p-16px"},W={key:0},X={key:1},D=L({__name:"index",props:{onRefresh:{type:Function},onOpenLog:{type:Function}},setup(L,{expose:D}){const{t:Q}=k(),V=L,G=A(null),I=z({auth_type:"dns",dns_manual:0,site:0,type:"wildcard",domains:"",domains_list:[],all:!1}),K=A([{label:Q("SSL.index_17"),value:"single"},{label:Q("SSL.index_18"),value:"wildcard"},{label:Q("SSL.index_19"),value:"wildcard_all"}]),T=A([]),Y=A([]),aa=()=>{I.domains=""},ea=()=>{I.domains_list=[],da()},la=$((()=>I.domains_list.length>0&&I.domains_list.length<Y.value.length));Z((()=>I.domains_list),(a=>{a.length===Y.value.length?I.all=!0:a.length||(I.all=!1)})),Z((()=>I.all),(a=>{var e;a?(I.domains_list=Y.value.map((a=>a.name)),null==(e=G.value)||e.validate()):I.domains_list=[]}));const ta={domains:{required:!0,trigger:"input",validator:(a,e)=>{if("single"===I.type){if(!e)return new Error(Q("SSL.index_20"));if(!/^[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+$/.test(e))return new Error(Q("SSL.index_21"))}else if("wildcard"===I.type){if(!e)return new Error(Q("SSL.index_22"));if(!/^(?:\*\.)?(?:[a-zA-Z0-9-]+\.)?[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+(\n(?:\*\.)?(?:[a-zA-Z0-9-]+\.)?[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+)*$/.test(e))return new Error(Q("SSL.index_23"))}else if("wildcard_all"===I.type){if(!e)return new Error(Q("SSL.index_24"));if(!/^\*\.[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+(\n\*\.[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+)*$/i.test(e))return new Error(Q("SSL.index_25"))}return!0}},domains_list:{required:!0,trigger:"change",type:"array",message:Q("SSL.SiteSSL.index_16")}},sa=()=>({auth_type:I.dns_manual?"dns_manual":I.auth_type,domains:JSON.stringify("http"===I.auth_type?I.domains_list:"single"===I.type?[I.domains]:I.domains.split("\n")),site_id:I.dns_manual?-1:void 0}),{loading:na,setLoading:ia}=a(),da=async()=>{try{ia(!0);const{message:a}=await r({id:I.site});c(a)&&(Y.value=a.map((a=>({name:a.name}))))}finally{ia(!1)}};return j((async()=>{await(async()=>{const{message:a}=await o();c(a)&&(T.value=a.map((a=>({label:a.name,value:a.id}))),I.site=T.value[0].value)})(),da()})),D({onConfirm:async()=>{var a;if(await(null==(a=G.value)?void 0:a.validate()),I.dns_manual){const a=JSON.stringify("http"===I.auth_type?I.domains_list:"single"===I.type?[I.domains]:I.domains.split("\n")),{message:e}=await l({site_id:-1,domains:a});if(m(e)&&Object.keys(e).length)return t(e.auths,-1,[I.domains],(()=>{V.onRefresh()}),!0),!1;const u=s({width:500,height:300,hideClose:!0,component:n});try{const{message:a}=await i(sa(),!1);if(m(a)){if(a.deploy)return void V.onRefresh();Array.isArray(a.auths)&&a.auths.length&&t(a.auths,-1,[I.domains],(()=>{V.onRefresh()}))}}catch(o){d(b(o,"message",""))}finally{u.hide()}return}const{message:e}=await i(sa());m(e)&&V.onOpenLog(e.path),V.onRefresh()}}),(a,l)=>{const t=v,s=p,n=f,i=h,d=y,o=S,r=x,m=w,c=g,b=_,L=u,k=e;return O(),U("div",P,[R(L,{ref_key:"formRef",ref:G,model:q(I),rules:ta,"label-width":"150px"},{default:E((()=>[R(i,{label:a.$t("Waf.Setting.config_67"),path:"verify_method"},{default:E((()=>[R(n,{value:q(I).auth_type,"onUpdate:value":l[0]||(l[0]=a=>q(I).auth_type=a)},{default:E((()=>[R(s,null,{default:E((()=>[R(t,{value:"dns"},{default:E((()=>[C(B(a.$t("SSL.index_12")),1)])),_:1}),R(t,{value:"http"},{default:E((()=>[C(B(a.$t("SSL.SiteSSL.index_17")),1)])),_:1})])),_:1})])),_:1},8,["value"])])),_:1},8,["label"]),"dns"===q(I).auth_type?(O(),U("div",W,[R(i,{label:" "},{default:E((()=>[R(d,{checked:q(I).dns_manual,"onUpdate:checked":l[1]||(l[1]=a=>q(I).dns_manual=a),"checked-value":1,"unchecked-value":0},{default:E((()=>[C(B(a.$t("SSL.index_2")),1)])),_:1},8,["checked"])])),_:1}),R(i,{label:a.$t("SSL.index_13"),path:"type"},{default:E((()=>[R(o,{class:"w-300px",value:q(I).type,"onUpdate:value":[l[2]||(l[2]=a=>q(I).type=a),aa],options:q(K)},null,8,["value","options"])])),_:1},8,["label"]),"single"===q(I).type?(O(),H(i,{key:0,label:" ",path:"domains"},{default:E((()=>[R(r,{"input-props":{spellcheck:!1},class:"w-300px!",value:q(I).domains,"onUpdate:value":l[3]||(l[3]=a=>q(I).domains=a),placeholder:"iPanel.com"},null,8,["value"])])),_:1})):F("",!0),"wildcard"===q(I).type?(O(),H(i,{key:1,label:" ",path:"domains"},{default:E((()=>[R(r,{"input-props":{spellcheck:!1},type:"textarea",class:"w-300px!",value:q(I).domains,"onUpdate:value":l[4]||(l[4]=a=>q(I).domains=a),placeholder:a.$t("SSL.index_14")},null,8,["value","placeholder"])])),_:1})):F("",!0),"wildcard_all"===q(I).type?(O(),H(i,{key:2,label:" ",path:"domains"},{default:E((()=>[R(r,{"input-props":{spellcheck:!1},type:"textarea",class:"w-300px!",value:q(I).domains,"onUpdate:value":l[5]||(l[5]=a=>q(I).domains=a),placeholder:"*.iPanel.com"},null,8,["value"])])),_:1})):F("",!0)])):F("",!0),"http"===q(I).auth_type?(O(),U("div",X,[R(i,{label:a.$t("Home.index_68")},{default:E((()=>[R(o,{class:"w-300px",value:q(I).site,"onUpdate:value":[l[6]||(l[6]=a=>q(I).site=a),ea],options:q(T)},null,8,["value","options"])])),_:1},8,["label"]),R(i,{label:a.$t("Mail.Bcc.index_6"),path:"domains_list"},{default:E((()=>[R(b,{show:q(na),class:"p-12px w-300px max-h-300px min-h-100px overflow-auto border border-solid border-#ccc"},{default:E((()=>[R(d,{class:"mb-12px",checked:q(I).all,"onUpdate:checked":l[7]||(l[7]=a=>q(I).all=a),label:a.$t("Public.SelectAll"),indeterminate:q(la)},null,8,["checked","label","indeterminate"]),R(c,{value:q(I).domains_list,"onUpdate:value":l[8]||(l[8]=a=>q(I).domains_list=a)},{default:E((()=>[R(m,{class:"flex-col!",size:12},{default:E((()=>[(O(!0),U(J,null,M(q(Y),(a=>(O(),H(d,{key:a.name,value:a.name,label:a.name},null,8,["value","label"])))),128))])),_:1})])),_:1},8,["value"])])),_:1},8,["show"])])),_:1},8,["label"])])):F("",!0)])),_:1},8,["model"]),R(k,{class:"mt-16px"},{default:E((()=>[N("li",null,B(a.$t("SSL.index_15")),1),l[9]||(l[9]=N("li",null,"Manually resolved certificates do not support auto-renewal",-1)),N("li",null,B(a.$t("SSL.index_16")),1)])),_:1,__:[9]})])}}});export{D as default};


