import{_ as e}from"./index127.js?v=1752142539265";import{_ as a}from"./index.js?v=1752142539265";import{c as l,e as t,b as o,h as n,d as i,f as s,_ as r,m as u}from"./public.js?v=1752142539265";import{_ as d}from"./index.vue_vue_type_script_setup_true_lang4.js?v=1752142539265";import{k as c,P as p,ac as _,r as f,U as m,X as v,V as w,Q as F,W as x,c as W,a1 as b,av as h,e as g,a2 as q,an as y,a3 as R,j as k,$}from"./vue.js?v=1752142539265";import{v as j,i as U,d7 as E,e as N,m as P,c$ as C,d8 as T,w as O}from"./page_layout.js?v=1752142539265";import{_ as M}from"./index.vue_vue_type_script_setup_true_lang.js?v=1752142539265";import{cD as A,aq as I,cH as B,bM as z,cz as L,cB as D,cC as H,_ as J,bZ as S,c1 as V,cA as Q,ay as X}from"./naive.js?v=1752142539265";import"./common.js?v=1752142539265";import"./__commonjsHelpers__.js?v=1752142539265";import"./index.vue_vue_type_script_setup_true_lang7.js?v=1752142539265";const Z={class:"flex w-380px"},G={class:"w-140px mr-12px"},K={class:"flex-1"},Y=c({__name:"path",props:{url:{},urlModifiers:{},type:{},typeModifiers:{}},emits:["update:url","update:type"],setup(e){const{t:a}=p(),l=_(e,"url"),t=_(e,"type"),o=f([{label:a("Waf.Flow.Form.index_36"),value:"url"},{label:a("Waf.Flow.Form.index_37"),value:"all"}]),n=e=>{if("all"===e)l.value="/"};return(e,a)=>{const i=A,s=I;return v(),m("div",Z,[w("div",G,[F(i,{value:t.value,"onUpdate:value":[a[0]||(a[0]=e=>t.value=e),n],options:x(o)},null,8,["value","options"])]),w("div",K,[F(s,{value:l.value,"onUpdate:value":a[1]||(a[1]=e=>l.value=e),disabled:"all"===t.value,placeholder:e.$t("Waf.Flow.Form.index_35")},null,8,["value","disabled","placeholder"])])])}}}),ee="allsite",ae=N(c({__name:"site",props:{value:{},valueModifiers:{}},emits:["update:value"],setup(e){const a=_(e,"value"),t=E(),{t:o}=p(),{loading:n,setLoading:i}=l(),s=f([]),r=f([{label:o("Waf.Flow.Form.index_39"),value:ee}]),u=W((()=>a.value===ee)),d=({option:e,handleClose:a})=>{if(e.value!==ee)return F(B,{class:"mr-6px",closable:!0,onClose:e=>{e.stopPropagation(),a()}},{default:()=>[e.label]})},c=e=>{u.value||(e.includes(ee)?(a.value=ee,s.value=r.value.map((e=>e.value))):e.length!==r.value.length-1?(a.value=e.filter((e=>e!==ee)),s.value=e.filter((e=>e!==ee))):e.length===r.value.length-1&&(a.value=ee,s.value=r.value.map((e=>e.value)))),u.value&&(e.includes(ee)?e.length!==r.value.length&&(a.value=e.filter((e=>e!==ee)),s.value=e.filter((e=>e!==ee))):(a.value=[],s.value=[]))};return(async()=>{try{i(!0),await t.getConfig(),r.value=Object.entries(t.config.sitemap).map((([e,a])=>({label:e,value:a}))),r.value.unshift({label:o("Waf.Flow.Form.index_39"),value:ee}),a.value===ee?s.value=r.value.map((e=>e.value)):z(a.value)&&(s.value=a.value)}finally{i(!1)}})(),(e,a)=>{const l=A;return v(),b(l,{loading:x(n),value:x(s),multiple:"",filterable:"",options:x(r),"max-tag-count":"responsive","consistent-menu-width":!1,"render-tag":d,placeholder:e.$t("Waf.Flow.Form.index_38"),"onUpdate:value":c},null,8,["loading","value","options","placeholder"])}}}),[["__scopeId","data-v-5842887f"]]),le={class:"p-24px"},te={class:"form-title"},oe={class:"w-380px"},ne={class:"w-380px"},ie={class:"form-title mt-8px"},se={class:"w-60px mx-8px"},re={class:"text-desc"},ue={class:"w-60px mx-8px"},de={class:"text-desc"},ce={class:"w-60px mx-8px"},pe={class:"text-desc"},_e={class:"form-title mt-8px"},fe={class:"w-380px"},me={class:"w-380px"},ve=N(c({__name:"index",props:{isEdit:{type:Boolean},row:{},refresh:{}},setup(e,{expose:a}){const l=e,{t:t}=p(),o=h("formRef"),n=g({name:"",server:[],types:"url",url:"",condition:1,secondReq:!0,secondReqNum:void 0,countReq:!1,countReqTime:void 0,countReqNum:void 0,action:"status_503",return:"html"}),i=f([{label:t("Waf.Flow.Form.index_16"),value:"status_403"},{label:t("Waf.Flow.Form.index_17"),value:"status_404"},{label:t("Waf.Flow.Form.index_18"),value:"status_502"},{label:t("Waf.Flow.Form.index_19"),value:"status_503"},{label:t("Waf.Flow.Form.index_20"),value:"content"},{label:t("Waf.Flow.Form.index_21"),value:"drop"}]),s=f([{label:t("Waf.Flow.Form.index_22"),value:"html"},{label:t("Waf.Flow.Form.index_23"),value:"json"},{label:t("Waf.Flow.Form.index_24"),value:"444"}]),r={name:{required:!0,trigger:["blur","input"],message:t("Waf.Flow.Form.index_3")},server:{trigger:["change"],validator:()=>!(n.server.length<=0)||new Error(t("Waf.Flow.Form.index_25"))},path:{trigger:["blur","input","change"],validator:()=>{if("url"===n.types){if(!n.url)return new Error(t("Waf.Flow.Form.index_26"));if("/"===n.url)return new Error(t("Waf.Flow.Form.index_27"));if(!n.url.startsWith("/"))return new Error(t("Waf.Flow.Form.index_28"))}return!0}},second:{trigger:["blur","input"],validator:()=>!(n.secondReq&&!n.secondReqNum)||new Error(t("Waf.Flow.Form.index_29"))},count:{trigger:["blur","input"],validator:()=>{if(n.countReq){if(!n.countReqTime)return new Error(t("Waf.Flow.Form.index_30"));if(n.countReqTime<30)return new Error(t("Waf.Flow.Form.index_31"));if(!n.countReqNum)return new Error(t("Waf.Flow.Form.index_32"));if(n.countReqNum<20)return new Error(t("Waf.Flow.Form.index_33"))}return!0}}};return(()=>{const{isEdit:e,row:a}=l;e&&a&&(n.name=a.name,n.server=Object.keys(a.site),n.types=a.types,n.url=a.url,n.condition=a.condition,n.secondReq=!!a.region.req,a.region.req&&(n.secondReqNum=a.region.req),n.countReq=!!a.region.count,a.region.count&&(n.countReqTime=a.region.count.time,n.countReqNum=a.region.count.count),n.action=a.action,"content"===a.action&&(n.return=a.return))})(),a({onConfirm:async()=>{var e,a;if(await(null==(e=o.value)?void 0:e.validate()),!1===n.secondReq&&!1===n.countReq)return P.error(t("Waf.Flow.Form.index_34"),{close:!0}),!1;const i={name:n.name,site:n.server.join(","),types:n.types,url:n.url,condition:n.condition,action:n.action,region:{...n.secondReq?{req:n.secondReqNum}:{},...n.countReq?{count:{time:n.countReqTime,count:n.countReqNum}}:{}},..."content"===n.action?{return:n.return}:{}},{row:s,isEdit:r}=l;var u;r&&s?await(u={...i,id:s.id},j.post("/btwaf/edit_user_limit.json",{data:JSON.stringify(u)},{requestOptions:{loading:U.global.t("Waf.Flow.API.index_2"),successMessage:!0}})):await(e=>j.post("/btwaf/add_user_limit.json",{data:JSON.stringify(e)},{requestOptions:{loading:U.global.t("Waf.Flow.API.index_1"),successMessage:!0}}))(i),null==(a=l.refresh)||a.call(l)}}),(e,a)=>{const l=I,t=L,u=H,d=D,c=J,p=S,_=A,f=M;return v(),m("div",le,[F(f,{ref_key:"formRef",ref:o,model:x(n),rules:r},{default:q((()=>[w("div",te,R(e.$t("Waf.Flow.Form.index_1")),1),F(t,{label:e.$t("Waf.Flow.Form.index_2"),path:"name"},{default:q((()=>[w("div",oe,[F(l,{value:x(n).name,"onUpdate:value":a[0]||(a[0]=e=>x(n).name=e),placeholder:e.$t("Waf.Flow.Form.index_3")},null,8,["value","placeholder"])])])),_:1},8,["label"]),F(t,{label:e.$t("Waf.Flow.Form.index_4"),path:"server"},{default:q((()=>[w("div",ne,[F(ae,{value:x(n).server,"onUpdate:value":a[1]||(a[1]=e=>x(n).server=e)},null,8,["value"])])])),_:1},8,["label"]),w("div",ie,R(e.$t("Waf.Flow.Form.index_5")),1),F(t,{label:e.$t("Waf.Flow.Form.index_6"),path:"path"},{default:q((()=>[F(Y,{type:x(n).types,"onUpdate:type":a[2]||(a[2]=e=>x(n).types=e),url:x(n).url,"onUpdate:url":a[3]||(a[3]=e=>x(n).url=e)},null,8,["type","url"])])),_:1},8,["label"]),F(t,{label:e.$t("Waf.Flow.Form.index_7")},{default:q((()=>[F(d,{value:x(n).condition,"onUpdate:value":a[4]||(a[4]=e=>x(n).condition=e)},{default:q((()=>[F(u,{value:1},{default:q((()=>[k(R(e.$t("Waf.Flow.Form.index_8")),1)])),_:1}),F(u,{value:2},{default:q((()=>a[12]||(a[12]=[k("IP+UA")]))),_:1,__:[12]}),F(u,{value:3},{default:q((()=>[k(R(e.$t("Waf.Flow.Form.index_9")),1)])),_:1})])),_:1},8,["value"])])),_:1},8,["label"]),F(t,{label:" ",path:"second"},{default:q((()=>[F(c,{checked:x(n).secondReq,"onUpdate:checked":a[5]||(a[5]=e=>x(n).secondReq=e)},{default:q((()=>[k(R(e.$t("Waf.Flow.Form.index_10")),1)])),_:1},8,["checked"]),w("div",se,[F(p,{value:x(n).secondReqNum,"onUpdate:value":a[6]||(a[6]=e=>x(n).secondReqNum=e),"show-button":!1,placeholder:""},null,8,["value"])]),w("div",re,R(e.$t("Public.Unit.Times")),1)])),_:1}),F(t,{label:" ",path:"count"},{default:q((()=>[F(c,{checked:x(n).countReq,"onUpdate:checked":a[7]||(a[7]=e=>x(n).countReq=e)},{default:q((()=>[k(R(e.$t("Waf.Flow.Form.index_11")),1)])),_:1},8,["checked"]),w("div",ue,[F(p,{value:x(n).countReqTime,"onUpdate:value":a[8]||(a[8]=e=>x(n).countReqTime=e),"show-button":!1,placeholder:""},null,8,["value"])]),w("div",de,R(e.$t("Waf.Flow.Form.index_12")),1),w("div",ce,[F(p,{value:x(n).countReqNum,"onUpdate:value":a[9]||(a[9]=e=>x(n).countReqNum=e),"show-button":!1,placeholder:""},null,8,["value"])]),w("div",pe,R(e.$t("Public.Unit.Times")),1)])),_:1}),w("div",_e,R(e.$t("Waf.Flow.Form.index_13")),1),F(t,{label:e.$t("Waf.Flow.Form.index_14")},{default:q((()=>[w("div",fe,[F(_,{value:x(n).action,"onUpdate:value":a[10]||(a[10]=e=>x(n).action=e),options:x(i)},null,8,["value","options"])])])),_:1},8,["label"]),"content"===x(n).action?(v(),b(t,{key:0,label:e.$t("Waf.Flow.Form.index_15")},{default:q((()=>[w("div",me,[F(_,{value:x(n).return,"onUpdate:value":a[11]||(a[11]=e=>x(n).return=e),options:x(s)},null,8,["value","options"])])])),_:1},8,["label"])):y("",!0)])),_:1},8,["model"])])}}}),[["__scopeId","data-v-8a3017c5"]]),we={class:"mr-8px"},Fe=c({__name:"index",setup(l){const{t:c}=p(),_=C(),{version:m}=$(_),h=f("9.6.0"),g=W((()=>T(m.value,h.value))),y=()=>{u("btwaf")},E=t(c("Waf.Flow.index_6"),{isEdit:!1,refresh:()=>I()}),N=()=>{E.data.row=null,E.data.isEdit=!1,E.title=c("Waf.Flow.index_6"),E.show=!0},{table:P,columns:M,setLoading:A}=o([{key:"name",title:c("Waf.Flow.index_8"),width:"12%",minWidth:160},{key:"site",title:c("Waf.Flow.index_9"),width:"16%",minWidth:200,render:e=>Object.keys(e.site).join(", ")},{key:"region",title:c("Waf.Flow.index_10"),minWidth:300,render:e=>{let a="";switch(e.condition){case 1:a=c("Waf.Flow.index_11");break;case 2:a=c("Waf.Flow.index_12");break;case 3:a=c("Waf.Flow.index_13")}const{region:l}=e;return l.req&&(a+=c("Waf.Flow.index_14",[l.req])),l.count&&l.count.count&&(l.req&&(a+=c("Waf.Flow.index_15")),a+=c("Waf.Flow.index_16",[l.count.time,l.count.count])),c("Waf.Flow.index_17",[a])}},{key:"action",title:c("Waf.Flow.index_18"),width:"16%",minWidth:260,render:e=>{let a="";switch(e.action){case"status_403":a=c("Waf.Flow.index_19");break;case"status_404":a=c("Waf.Flow.index_20");break;case"status_502":a=c("Waf.Flow.index_21");break;case"status_503":a=c("Waf.Flow.index_22");break;case"content":a=c("Waf.Flow.index_23");break;case"drop":a=c("Waf.Flow.index_24")}return a}},{key:"open",title:c("Waf.Flow.index_25"),width:"6%",minWidth:80,render:e=>F(V,{size:"small",value:e.open,onUpdateValue:async a=>{var l;await(l={id:e.id},j.post("/btwaf/set_user_limit.json",l,{requestOptions:{loading:U.global.t("Waf.Flow.API.index_3"),successMessage:!0}})),e.open=a}},null)},n({width:100,options:e=>[{label:c("Public.Btn.Edit"),onClick:()=>{(e=>{E.data.row=e,E.data.isEdit=!0,E.title=c("Waf.Flow.index_7"),E.show=!0})(e)}},{label:c("Public.Btn.Del"),onClick:()=>{i({title:c("Waf.Flow.index_26"),content:c("Waf.Flow.index_27",[e.name]),onConfirm:async()=>{var a;await(a={id:e.id},j.post("/btwaf/del_user_limit.json",a,{requestOptions:{loading:U.global.t("Waf.Flow.API.index_4"),successMessage:!0}})),I()}})}}]})]),I=async()=>{try{A(!0);const{message:e}=await j.post("/btwaf/get_user_limit.json");P.data=O(e)?e:[]}finally{A(!1)}};return g.value&&I(),(l,t)=>{const o=X,n=s,i=d,u=r,c=a,p=Q,_=e;return v(),b(_,{install:x(g)},{desc:q((()=>[w("span",we," The WAF is v"+R(x(m))+", please upgrade to the version above v"+R(x(h))+" to use ",1),F(o,{class:"px-8px h-24px",type:"primary",size:"small",onClick:y},{default:q((()=>t[1]||(t[1]=[k(" Upgrade ")]))),_:1,__:[1]})])),default:q((()=>[F(p,{class:"p-16px"},{default:q((()=>[F(i,null,{toolsLeft:q((()=>[F(o,{type:"primary",onClick:N},{default:q((()=>[k(R(l.$t("Waf.Flow.index_1")),1)])),_:1})])),table:q((()=>[F(n,{loading:x(P).loading,data:x(P).data,columns:x(M)},null,8,["loading","data","columns"])])),_:1}),F(u,{class:"mt-16px"},{default:q((()=>[w("li",null,R(l.$t("Waf.Flow.index_2")),1),w("li",null,R(l.$t("Waf.Flow.index_3")),1),w("li",null,R(l.$t("Waf.Flow.index_4")),1),w("li",null,R(l.$t("Waf.Flow.index_5")),1)])),_:1}),F(c,{show:x(E).show,"onUpdate:show":t[0]||(t[0]=e=>x(E).show=e),title:x(E).title,width:640,footer:!0,data:x(E).data,component:ve},null,8,["show","title","data"])])),_:1})])),_:1},8,["install"])}}});export{Fe as default};
