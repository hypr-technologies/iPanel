System.register(["./index-legacy127.js?v=1752142539265","./index-legacy.js?v=1752142539265","./public-legacy.js?v=1752142539265","./index.vue_vue_type_script_setup_true_lang-legacy4.js?v=1752142539265","./vue-legacy.js?v=1752142539265","./page_layout-legacy.js?v=1752142539265","./index.vue_vue_type_script_setup_true_lang-legacy.js?v=1752142539265","./naive-legacy.js?v=1752142539265","./common-legacy.js?v=1752142539265","./__commonjsHelpers__-legacy.js?v=1752142539265","./index.vue_vue_type_script_setup_true_lang-legacy7.js?v=1752142539265"],(function(e,l){"use strict";var a,t,n,o,i,u,r,s,d,c,_,p,v,f,m,w,x,F,g,W,b,h,y,q,R,$,k,j,U,E,N,C,P,T,O,M,A,I,z,B,L,S,D,H,J,V,Q,X,Z,G;return{setters:[e=>{a=e._},e=>{t=e._},e=>{n=e.c,o=e.e,i=e.b,u=e.h,r=e.d,s=e.f,d=e._,c=e.m},e=>{_=e._},e=>{p=e.k,v=e.P,f=e.ac,m=e.r,w=e.U,x=e.X,F=e.V,g=e.Q,W=e.W,b=e.c,h=e.a1,y=e.av,q=e.e,R=e.a2,$=e.an,k=e.a3,j=e.j,U=e.$},e=>{E=e.v,N=e.i,C=e.d7,P=e.e,T=e.m,O=e.c$,M=e.d8,A=e.w},e=>{I=e._},e=>{z=e.cD,B=e.aq,L=e.cH,S=e.bM,D=e.cz,H=e.cB,J=e.cC,V=e._,Q=e.bZ,X=e.c1,Z=e.cA,G=e.ay},null,null,null],execute:function(){var l=document.createElement("style");l.textContent=".n-select[data-v-5842887f] .n-base-selection-tag-wrapper{padding:0 0 3px}.form-title[data-v-8a3017c5]{margin-bottom:20px;font-size:16px}\n/*$vite$:1*/",document.head.appendChild(l);const K={class:"flex w-380px"},Y={class:"w-140px mr-12px"},ee={class:"flex-1"},le=p({__name:"path",props:{url:{},urlModifiers:{},type:{},typeModifiers:{}},emits:["update:url","update:type"],setup(e){const{t:l}=v(),a=f(e,"url"),t=f(e,"type"),n=m([{label:l("Waf.Flow.Form.index_36"),value:"url"},{label:l("Waf.Flow.Form.index_37"),value:"all"}]),o=e=>{"all"===e&&(a.value="/")};return(e,l)=>{const i=z,u=B;return x(),w("div",K,[F("div",Y,[g(i,{value:t.value,"onUpdate:value":[l[0]||(l[0]=e=>t.value=e),o],options:W(n)},null,8,["value","options"])]),F("div",ee,[g(u,{value:a.value,"onUpdate:value":l[1]||(l[1]=e=>a.value=e),disabled:"all"===t.value,placeholder:e.$t("Waf.Flow.Form.index_35")},null,8,["value","disabled","placeholder"])])])}}}),ae="allsite",te=P(p({__name:"site",props:{value:{},valueModifiers:{}},emits:["update:value"],setup(e){const l=f(e,"value"),a=C(),{t:t}=v(),{loading:o,setLoading:i}=n(),u=m([]),r=m([{label:t("Waf.Flow.Form.index_39"),value:ae}]),s=b((()=>l.value===ae)),d=({option:e,handleClose:l})=>{if(e.value!==ae)return g(L,{class:"mr-6px",closable:!0,onClose:e=>{e.stopPropagation(),l()}},{default:()=>[e.label]})},c=e=>{s.value||(e.includes(ae)?(l.value=ae,u.value=r.value.map((e=>e.value))):e.length!==r.value.length-1?(l.value=e.filter((e=>e!==ae)),u.value=e.filter((e=>e!==ae))):e.length===r.value.length-1&&(l.value=ae,u.value=r.value.map((e=>e.value)))),s.value&&(e.includes(ae)?e.length!==r.value.length&&(l.value=e.filter((e=>e!==ae)),u.value=e.filter((e=>e!==ae))):(l.value=[],u.value=[]))};return(async()=>{try{i(!0),await a.getConfig(),r.value=Object.entries(a.config.sitemap).map((([e,l])=>({label:e,value:l}))),r.value.unshift({label:t("Waf.Flow.Form.index_39"),value:ae}),l.value===ae?u.value=r.value.map((e=>e.value)):S(l.value)&&(u.value=l.value)}finally{i(!1)}})(),(e,l)=>{const a=z;return x(),h(a,{loading:W(o),value:W(u),multiple:"",filterable:"",options:W(r),"max-tag-count":"responsive","consistent-menu-width":!1,"render-tag":d,placeholder:e.$t("Waf.Flow.Form.index_38"),"onUpdate:value":c},null,8,["loading","value","options","placeholder"])}}}),[["__scopeId","data-v-5842887f"]]),ne={class:"p-24px"},oe={class:"form-title"},ie={class:"w-380px"},ue={class:"w-380px"},re={class:"form-title mt-8px"},se={class:"w-60px mx-8px"},de={class:"text-desc"},ce={class:"w-60px mx-8px"},_e={class:"text-desc"},pe={class:"w-60px mx-8px"},ve={class:"text-desc"},fe={class:"form-title mt-8px"},me={class:"w-380px"},we={class:"w-380px"},xe=p({__name:"index",props:{isEdit:{type:Boolean},row:{},refresh:{}},setup(e,{expose:l}){const a=e,{t:t}=v(),n=y("formRef"),o=q({name:"",server:[],types:"url",url:"",condition:1,secondReq:!0,secondReqNum:void 0,countReq:!1,countReqTime:void 0,countReqNum:void 0,action:"status_503",return:"html"}),i=m([{label:t("Waf.Flow.Form.index_16"),value:"status_403"},{label:t("Waf.Flow.Form.index_17"),value:"status_404"},{label:t("Waf.Flow.Form.index_18"),value:"status_502"},{label:t("Waf.Flow.Form.index_19"),value:"status_503"},{label:t("Waf.Flow.Form.index_20"),value:"content"},{label:t("Waf.Flow.Form.index_21"),value:"drop"}]),u=m([{label:t("Waf.Flow.Form.index_22"),value:"html"},{label:t("Waf.Flow.Form.index_23"),value:"json"},{label:t("Waf.Flow.Form.index_24"),value:"444"}]),r={name:{required:!0,trigger:["blur","input"],message:t("Waf.Flow.Form.index_3")},server:{trigger:["change"],validator:()=>!(o.server.length<=0)||new Error(t("Waf.Flow.Form.index_25"))},path:{trigger:["blur","input","change"],validator:()=>{if("url"===o.types){if(!o.url)return new Error(t("Waf.Flow.Form.index_26"));if("/"===o.url)return new Error(t("Waf.Flow.Form.index_27"));if(!o.url.startsWith("/"))return new Error(t("Waf.Flow.Form.index_28"))}return!0}},second:{trigger:["blur","input"],validator:()=>!(o.secondReq&&!o.secondReqNum)||new Error(t("Waf.Flow.Form.index_29"))},count:{trigger:["blur","input"],validator:()=>{if(o.countReq){if(!o.countReqTime)return new Error(t("Waf.Flow.Form.index_30"));if(o.countReqTime<30)return new Error(t("Waf.Flow.Form.index_31"));if(!o.countReqNum)return new Error(t("Waf.Flow.Form.index_32"));if(o.countReqNum<20)return new Error(t("Waf.Flow.Form.index_33"))}return!0}}};return(()=>{const{isEdit:e,row:l}=a;e&&l&&(o.name=l.name,o.server=Object.keys(l.site),o.types=l.types,o.url=l.url,o.condition=l.condition,o.secondReq=!!l.region.req,l.region.req&&(o.secondReqNum=l.region.req),o.countReq=!!l.region.count,l.region.count&&(o.countReqTime=l.region.count.time,o.countReqNum=l.region.count.count),o.action=l.action,"content"===l.action&&(o.return=l.return))})(),l({onConfirm:async()=>{if(await(n.value?.validate()),!1===o.secondReq&&!1===o.countReq)return T.error(t("Waf.Flow.Form.index_34"),{close:!0}),!1;const e={name:o.name,site:o.server.join(","),types:o.types,url:o.url,condition:o.condition,action:o.action,region:{...o.secondReq?{req:o.secondReqNum}:{},...o.countReq?{count:{time:o.countReqTime,count:o.countReqNum}}:{}},..."content"===o.action?{return:o.return}:{}},{row:l,isEdit:i}=a;var u;i&&l?await(u={...e,id:l.id},E.post("/btwaf/edit_user_limit.json",{data:JSON.stringify(u)},{requestOptions:{loading:N.global.t("Waf.Flow.API.index_2"),successMessage:!0}})):await(e=>E.post("/btwaf/add_user_limit.json",{data:JSON.stringify(e)},{requestOptions:{loading:N.global.t("Waf.Flow.API.index_1"),successMessage:!0}}))(e),a.refresh?.()}}),(e,l)=>{const a=B,t=D,s=J,d=H,c=V,_=Q,p=z,v=I;return x(),w("div",ne,[g(v,{ref_key:"formRef",ref:n,model:W(o),rules:r},{default:R((()=>[F("div",oe,k(e.$t("Waf.Flow.Form.index_1")),1),g(t,{label:e.$t("Waf.Flow.Form.index_2"),path:"name"},{default:R((()=>[F("div",ie,[g(a,{value:W(o).name,"onUpdate:value":l[0]||(l[0]=e=>W(o).name=e),placeholder:e.$t("Waf.Flow.Form.index_3")},null,8,["value","placeholder"])])])),_:1},8,["label"]),g(t,{label:e.$t("Waf.Flow.Form.index_4"),path:"server"},{default:R((()=>[F("div",ue,[g(te,{value:W(o).server,"onUpdate:value":l[1]||(l[1]=e=>W(o).server=e)},null,8,["value"])])])),_:1},8,["label"]),F("div",re,k(e.$t("Waf.Flow.Form.index_5")),1),g(t,{label:e.$t("Waf.Flow.Form.index_6"),path:"path"},{default:R((()=>[g(le,{type:W(o).types,"onUpdate:type":l[2]||(l[2]=e=>W(o).types=e),url:W(o).url,"onUpdate:url":l[3]||(l[3]=e=>W(o).url=e)},null,8,["type","url"])])),_:1},8,["label"]),g(t,{label:e.$t("Waf.Flow.Form.index_7")},{default:R((()=>[g(d,{value:W(o).condition,"onUpdate:value":l[4]||(l[4]=e=>W(o).condition=e)},{default:R((()=>[g(s,{value:1},{default:R((()=>[j(k(e.$t("Waf.Flow.Form.index_8")),1)])),_:1}),g(s,{value:2},{default:R((()=>l[12]||(l[12]=[j("IP+UA")]))),_:1,__:[12]}),g(s,{value:3},{default:R((()=>[j(k(e.$t("Waf.Flow.Form.index_9")),1)])),_:1})])),_:1},8,["value"])])),_:1},8,["label"]),g(t,{label:" ",path:"second"},{default:R((()=>[g(c,{checked:W(o).secondReq,"onUpdate:checked":l[5]||(l[5]=e=>W(o).secondReq=e)},{default:R((()=>[j(k(e.$t("Waf.Flow.Form.index_10")),1)])),_:1},8,["checked"]),F("div",se,[g(_,{value:W(o).secondReqNum,"onUpdate:value":l[6]||(l[6]=e=>W(o).secondReqNum=e),"show-button":!1,placeholder:""},null,8,["value"])]),F("div",de,k(e.$t("Public.Unit.Times")),1)])),_:1}),g(t,{label:" ",path:"count"},{default:R((()=>[g(c,{checked:W(o).countReq,"onUpdate:checked":l[7]||(l[7]=e=>W(o).countReq=e)},{default:R((()=>[j(k(e.$t("Waf.Flow.Form.index_11")),1)])),_:1},8,["checked"]),F("div",ce,[g(_,{value:W(o).countReqTime,"onUpdate:value":l[8]||(l[8]=e=>W(o).countReqTime=e),"show-button":!1,placeholder:""},null,8,["value"])]),F("div",_e,k(e.$t("Waf.Flow.Form.index_12")),1),F("div",pe,[g(_,{value:W(o).countReqNum,"onUpdate:value":l[9]||(l[9]=e=>W(o).countReqNum=e),"show-button":!1,placeholder:""},null,8,["value"])]),F("div",ve,k(e.$t("Public.Unit.Times")),1)])),_:1}),F("div",fe,k(e.$t("Waf.Flow.Form.index_13")),1),g(t,{label:e.$t("Waf.Flow.Form.index_14")},{default:R((()=>[F("div",me,[g(p,{value:W(o).action,"onUpdate:value":l[10]||(l[10]=e=>W(o).action=e),options:W(i)},null,8,["value","options"])])])),_:1},8,["label"]),"content"===W(o).action?(x(),h(t,{key:0,label:e.$t("Waf.Flow.Form.index_15")},{default:R((()=>[F("div",we,[g(p,{value:W(o).return,"onUpdate:value":l[11]||(l[11]=e=>W(o).return=e),options:W(u)},null,8,["value","options"])])])),_:1},8,["label"])):$("",!0)])),_:1},8,["model"])])}}}),Fe=P(xe,[["__scopeId","data-v-8a3017c5"]]),ge={class:"mr-8px"};e("default",p({__name:"index",setup(e){const{t:l}=v(),n=O(),{version:p}=U(n),f=m("9.6.0"),w=b((()=>M(p.value,f.value))),y=()=>{c("btwaf")},q=o(l("Waf.Flow.index_6"),{isEdit:!1,refresh:()=>I()}),$=()=>{q.data.row=null,q.data.isEdit=!1,q.title=l("Waf.Flow.index_6"),q.show=!0},{table:C,columns:P,setLoading:T}=i([{key:"name",title:l("Waf.Flow.index_8"),width:"12%",minWidth:160},{key:"site",title:l("Waf.Flow.index_9"),width:"16%",minWidth:200,render:e=>Object.keys(e.site).join(", ")},{key:"region",title:l("Waf.Flow.index_10"),minWidth:300,render:e=>{let a="";switch(e.condition){case 1:a=l("Waf.Flow.index_11");break;case 2:a=l("Waf.Flow.index_12");break;case 3:a=l("Waf.Flow.index_13")}const{region:t}=e;return t.req&&(a+=l("Waf.Flow.index_14",[t.req])),t.count&&t.count.count&&(t.req&&(a+=l("Waf.Flow.index_15")),a+=l("Waf.Flow.index_16",[t.count.time,t.count.count])),l("Waf.Flow.index_17",[a])}},{key:"action",title:l("Waf.Flow.index_18"),width:"16%",minWidth:260,render:e=>{let a="";switch(e.action){case"status_403":a=l("Waf.Flow.index_19");break;case"status_404":a=l("Waf.Flow.index_20");break;case"status_502":a=l("Waf.Flow.index_21");break;case"status_503":a=l("Waf.Flow.index_22");break;case"content":a=l("Waf.Flow.index_23");break;case"drop":a=l("Waf.Flow.index_24")}return a}},{key:"open",title:l("Waf.Flow.index_25"),width:"6%",minWidth:80,render:e=>g(X,{size:"small",value:e.open,onUpdateValue:async l=>{var a;await(a={id:e.id},E.post("/btwaf/set_user_limit.json",a,{requestOptions:{loading:N.global.t("Waf.Flow.API.index_3"),successMessage:!0}})),e.open=l}},null)},u({width:100,options:e=>[{label:l("Public.Btn.Edit"),onClick:()=>{(e=>{q.data.row=e,q.data.isEdit=!0,q.title=l("Waf.Flow.index_7"),q.show=!0})(e)}},{label:l("Public.Btn.Del"),onClick:()=>{r({title:l("Waf.Flow.index_26"),content:l("Waf.Flow.index_27",[e.name]),onConfirm:async()=>{var l;await(l={id:e.id},E.post("/btwaf/del_user_limit.json",l,{requestOptions:{loading:N.global.t("Waf.Flow.API.index_4"),successMessage:!0}})),I()}})}}]})]),I=async()=>{try{T(!0);const{message:e}=await E.post("/btwaf/get_user_limit.json");C.data=A(e)?e:[]}finally{T(!1)}};return w.value&&I(),(e,l)=>{const n=G,o=s,i=_,u=d,r=t,c=Z,v=a;return x(),h(v,{install:W(w)},{desc:R((()=>[F("span",ge," The WAF is v"+k(W(p))+", please upgrade to the version above v"+k(W(f))+" to use ",1),g(n,{class:"px-8px h-24px",type:"primary",size:"small",onClick:y},{default:R((()=>l[1]||(l[1]=[j(" Upgrade ")]))),_:1,__:[1]})])),default:R((()=>[g(c,{class:"p-16px"},{default:R((()=>[g(i,null,{toolsLeft:R((()=>[g(n,{type:"primary",onClick:$},{default:R((()=>[j(k(e.$t("Waf.Flow.index_1")),1)])),_:1})])),table:R((()=>[g(o,{loading:W(C).loading,data:W(C).data,columns:W(P)},null,8,["loading","data","columns"])])),_:1}),g(u,{class:"mt-16px"},{default:R((()=>[F("li",null,k(e.$t("Waf.Flow.index_2")),1),F("li",null,k(e.$t("Waf.Flow.index_3")),1),F("li",null,k(e.$t("Waf.Flow.index_4")),1),F("li",null,k(e.$t("Waf.Flow.index_5")),1)])),_:1}),g(r,{show:W(q).show,"onUpdate:show":l[0]||(l[0]=e=>W(q).show=e),title:W(q).title,width:640,footer:!0,data:W(q).data,component:Fe},null,8,["show","title","data"])])),_:1})])),_:1},8,["install"])}}}))}}}));
